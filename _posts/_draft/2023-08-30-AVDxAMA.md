---
layout: post
title:  "Next-Level AVD Monitoring: Leveraging Azure Monitor Agent's Advanced Capabilities"
date:   2023-08-31 15:00:00 +0100
categories: AVD
tags: [AVD,Azure Monitor,Azure]
---
# Next-Level AVD Monitoring: Leveraging Azure Monitor Agent's Advanced Capabilities

## Table of contents
1. [Introduction](#Introduction)
2. [Understanding the Function of Azure Monitor Agent](#Understanding-the-Function-of-Azure-Monitor-Agent)
3. [Enabling AVD Insight (Preview) Using Azure Monitor Agent](#Enabling-AVD-Insight-Preview-Using-Azure-Monitor-Agent)
4. [Provisioning AVD Session Hosts with Azure Monitor Agent via ARM Template](#Provisioning-AVD-Session-Hosts-with-Azure-Monitor-Agent-via-ARM-Template)
5. [Validating Azure Monitor Data for AVD Insights](#Validating-Azure-Monitor-Data-for-AVD-Insights)
6. [Conclusion](#Conclusion)

## Introduction

>**Info:** On 31 August 2024, we'll retire the Log Analytics agent that you use in Azure Monitor.â€¯Before that date, you'll need to start using the Azure Monitor agent to monitor your VMs and servers in Azure. [Source](https://azure.microsoft.com/en-us/updates/were-retiring-the-log-analytics-agent-in-azure-monitor-on-31-august-2024/)



https://azure.microsoft.com/en-us/updates/public-preview-azure-virtual-desktop-insights-powered-by-the-azure-monitor-agent/


## Understanding the Function of Azure Monitor Agent

Azure Monitor Agent serves as a bridge between AVD deployments and Azure Monitor, enabling administrators to gain real-time insights into the performance and health of their virtual desktop environments. By collecting essential telemetry data from AVD infrastructure and session hosts, the agent facilitates informed decision-making, proactive issue resolution, and overall optimization.

https://learn.microsoft.com/en-us/azure/azure-monitor/agents/agents-overview


## Enabling AVD Insight (Preview) Using Azure Monitor Agent

https://learn.microsoft.com/en-us/azure/virtual-desktop/insights?tabs=monitor

https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/data-collection-rule-overview


### Requirements

### Limitations

## Provisioning AVD Session Hosts with Azure Monitor Agent via ARM Template

https://learn.microsoft.com/en-us/azure/azure-monitor/agents/resource-manager-data-collection-rules?tabs=json#create-association-with-azure-vm

```
{
	"type": "Microsoft.Insights/dataCollectionRuleAssociations",
	"apiVersion": "2021-09-01-preview",
    "name": "AzureMonitorDataCollectionRuleAssociations",
    "scope": "[format('Microsoft.Compute/virtualMachines/{0}', concat(parameters('rdshNamePrefix'), parameters('vmNumber')))]",
    "dependsOn": [
        "Your-Previous-Task"
    ],
	"properties": {
        "description": "Association of data collection rule. Deleting this association will break the data collection for this virtual machine.",
        "dataCollectionRuleId": "[parameters('dataCollectionRuleId')]"
        }
}
```




## Validating Azure Monitor Data for AVD Insights




## Conclusion
